<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amside AI - Interfaz Avanzada</title>
    <style>
        :root {
            --primary-color: #22272b; /* Dark Background */
            --secondary-color: #37404a; /* Darker Grey */
            --accent-color: #00bcd4; /* Cyan */
            --text-color-primary: #eee;
            --text-color-secondary: #ccc;
            --error-color: #f44336; /* Red accent */
            --border-radius: 8px;
            --box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
            --transition: all 0.3s ease-in-out;
            --sidebar-width: 300px;
        }

        body {
            font-family: 'Roboto Mono', monospace;
            background-color: var(--primary-color);
            color: var(--text-color-primary);
            margin: 0;
            display: flex;
            min-height: 100vh;
            padding: 0;
        }

        .sidebar {
            background-color: var(--secondary-color);
            width: var(--sidebar-width);
            border-right: 1px solid #444d57;
            padding: 25px;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }

        .sidebar-header {
            color: var(--text-color-primary);
            margin-bottom: 30px;
            text-align: left;
            width: 100%;
        }

        .sidebar-header h2 {
            margin: 0;
            font-size: 1.8em;
            font-weight: 400;
        }

        .new-chat-button {
            background-color: var(--accent-color);
            color: var(--text-color-primary);
            border: none;
            padding: 12px 18px;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 1em;
            margin-bottom: 20px;
            transition: background-color var(--transition);
            width: 100%;
            text-align: left;
            display: flex;
            align-items: center;
            justify-content: flex-start;
        }

        .new-chat-button svg {
            margin-right: 10px;
        }

        .chat-list-title {
            font-size: 0.9em;
            color: var(--text-color-secondary);
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 0.8px;
        }

        .chat-list {
            list-style: none;
            padding: 0;
            margin: 0;
            width: 100%;
        }

        .chat-list li {
            padding: 10px 15px;
            border-radius: var(--border-radius);
            margin-bottom: 6px;
            cursor: pointer;
            background-color: #2c343c;
            color: var(--text-color-secondary);
            transition: background-color var(--transition), color var(--transition);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .chat-list li:hover {
            background-color: var(--accent-color);
            color: var(--text-color-primary);
        }

        .chat-container {
            background-color: var(--primary-color);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            flex-grow: 1;
            margin: 20px;
            border: 1px solid #333a40;
        }

        .chat-header {
            background-color: var(--secondary-color);
            color: var(--text-color-primary);
            padding: 15px 20px;
            text-align: left;
            border-bottom: 1px solid #444d57;
            border-top-left-radius: var(--border-radius);
            border-top-right-radius: var(--border-radius);
            display: flex;
            align-items: center;
        }

        .chat-header button {
            background: none;
            border: none;
            color: var(--text-color-primary);
            font-size: 1em;
            cursor: pointer;
            margin-right: 20px;
            padding: 8px 12px;
            border-radius: var(--border-radius);
            transition: background-color var(--transition);
        }

        .chat-header button:hover {
            background-color: #444d57;
        }

        .chat-header h2 {
            margin: 0;
            font-size: 1.4em;
            font-weight: 400;
        }

        .chat-body {
            padding: 20px;
            overflow-y: auto;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .message {
            background-color: #2c343c;
            color: var(--text-color-secondary);
            border-radius: var(--border-radius);
            padding: 10px 14px;
            word-break: break-word;
            align-self: flex-start;
            max-width: 80%;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            font-size: 0.95em;
        }

        .error-message {
            background-color: #422b2b;
            color: var(--error-color);
            border-radius: var(--border-radius);
            padding: 10px 14px;
            word-break: break-word;
            align-self: flex-start;
            max-width: 80%;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            font-size: 0.95em;
            border: 1px solid #5a3232;
        }

        .user-message-container {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            max-width: 80%;
            align-self: flex-end;
        }

        .user-message {
            background-color: var(--accent-color);
            color: var(--text-color-primary);
            border-radius: var(--border-radius);
            padding: 10px 14px;
            word-break: break-word;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            font-size: 0.95em;
            margin-bottom: 5px;
        }

        .loading-indicator {
            display: flex; /* Always display but control visibility via JS or parent */
            align-self: flex-end;
            margin-top: 5px;
            align-items: center;
            font-size: 0.8em;
            color: var(--text-color-secondary);
        }

        .loading-spinner {
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-top: 2px solid var(--accent-color);
            border-radius: 50%;
            width: 14px;
            height: 14px;
            animation: spin 1s linear infinite;
            margin-left: 6px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .input-area {
            padding: 15px;
            border-top: 1px solid #444d57;
            display: flex;
            align-items: center;
            background-color: var(--secondary-color);
            border-bottom-left-radius: var(--border-radius);
            border-bottom-right-radius: var(--border-radius);
        }

        .input-field {
            flex-grow: 1;
            padding: 10px 12px;
            border: 1px solid #555e68;
            border-radius: var(--border-radius);
            margin-right: 10px;
            font-size: 0.95em;
            color: var(--text-color-primary);
            background-color: #2c343c;
        }

        .input-field:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 1px 3px rgba(var(--accent-color-rgb), 0.2);
        }

        .send-button {
            background-color: var(--accent-color);
            color: var(--text-color-primary);
            border: none;
            padding: 10px 15px;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 0.95em;
            transition: background-color var(--transition);
        }

        .send-button:hover {
            background-color: #00838f; /* Cyan darken-1 */
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">
</head>
<body>
    <div class="sidebar">
        <div class="sidebar-header">
            <h2>Amside AI</h2>
        </div>
        <button class="new-chat-button" id="new-chat-button">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-plus-square-fill" viewBox="0 0 16 16">
                <path d="M2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2zm6.5 4.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3a.5.5 0 0 1 1 0z"/>
            </svg>
            Nueva Conversación
        </button>
        <h3 class="chat-list-title">Historial</h3>
        <ul class="chat-list" id="chat-list">
            </ul>
    </div>
    <div class="chat-container">
        <div class="chat-header">
            <button id="new-conversation-header-button">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-plus-square-fill" viewBox="0 0 16 16">
                    <path d="M2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2zm6.5 4.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3a.5.5 0 0 1 1 0z"/>
                </svg>
                Nuevo
            </button>
            <h2>Chat</h2>
        </div>
        <div class="chat-body" id="chat-messages">
            </div>
        <div class="input-area">
            <input type="text" class="input-field" placeholder="Escribe tu mensaje...">
            <button class="send-button" id="send-button">Enviar</button>
        </div>
    </div>

    <script>
        const chatMessages = document.getElementById('chat-messages');
        const inputField = document.querySelector('.input-field');
        const sendButton = document.getElementById('send-button');
        const chatList = document.getElementById('chat-list');
        const newChatButtonSidebar = document.getElementById('new-chat-button');
        const newChatButtonHeader = document.getElementById('new-conversation-header-button');

        let chatHistory = [];
        let currentChat = [];

        // --- Diccionario de respuestas predefinidas ---
        const predefinedResponses = {
            "hola": [
                "¡Hola! ¿En qué puedo ayudarte hoy?",
                "¡Saludos! ¿Cómo estás?",
                "Hola, me alegra verte. ¿Tienes alguna pregunta?",
                "¡Qué bien que estés aquí! Dime, ¿qué necesitas?",
                "Hola, ¿en qué podemos empezar a trabajar?"
            ],
            "gracias": [
                "De nada, ¡es un placer ayudarte!",
                "¡No hay de qué! Estoy aquí para lo que necesites.",
                "A ti por usarme. ¡Cuando quieras!",
                "Con gusto. Me alegra haber sido útil.",
                "¡Encantado de ayudarte!"
            ],
            "quién eres": [
                "Soy Amside AI, un asistente de inteligencia artificial diseñado para ayudarte.",
                "Soy tu asistente virtual, Amside AI. ¿En qué puedo serte útil?",
                "Me llamo Amside AI. Estoy aquí para procesar información y responder tus preguntas.",
                "Soy una IA, Amside AI, creada para asistir en diversas tareas. ¿Qué te gustaría saber?",
                "Puedes llamarme Amside AI, soy un programa de inteligencia artificial."
            ],
            "qué haces": [
                "Puedo responder a tus preguntas, ayudarte con información y mantener conversaciones.",
                "Mi función principal es procesar tu información y ofrecerte respuestas útiles.",
                "Asisto en tareas informativas, respondo a tus dudas y te acompaño en el diálogo.",
                "Estoy programado para ayudarte a encontrar información y resolver consultas.",
                "Realizo diversas funciones, desde responder preguntas hasta generar ideas. ¿Qué tarea tienes en mente?"
            ],
            "ayuda": [
                "Claro, ¿en qué necesitas ayuda específicamente?",
                "¡Dime! ¿Qué problema o consulta tienes?",
                "Estoy aquí para ayudarte. Por favor, explica lo que necesitas.",
                "Con gusto te asisto. ¿Cuál es tu pregunta o dificultad?",
                "¿Cómo puedo ser de utilidad? Explícame tu situación."
            ],
            "adiós": [
                "¡Adiós! Que tengas un buen día.",
                "¡Hasta pronto! Espero verte de nuevo.",
                "Despedida. Cuídate mucho.",
                "¡Nos vemos! Fue un placer conversar contigo.",
                "¡Adiós! Siempre estoy aquí si me necesitas."
            ],
            "cómo estás": [
                "Soy un programa de computadora, así que no tengo sentimientos, pero estoy listo para funcionar.",
                "No tengo un estado de ánimo, pero estoy operando perfectamente y listo para ayudarte.",
                "Como IA, no 'estoy' de ninguna manera, pero agradezco tu interés. ¿Y tú?",
                "Estoy bien, gracias por preguntar. Siempre en línea y listo para asistir.",
                "¡Excelente! Siempre listo para interactuar y ayudarte."
            ],
            "tiempo": [
                "Para el tiempo actual, necesitaría saber tu ubicación exacta. ¿Me la podrías proporcionar?",
                "No tengo acceso directo a datos meteorológicos en tiempo real. Te sugiero consultar una aplicación del tiempo.",
                "El pronóstico del tiempo puede variar. ¿Hay alguna ciudad o región específica que te interese?",
                "Lamentablemente, no puedo darte el tiempo ahora mismo. Te recomiendo usar un servicio de meteorología."
            ],
            "fecha": [
                `Hoy es ${new Date().toLocaleDateString('es-ES', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}.`,
                `La fecha actual es ${new Date().toLocaleDateString('es-ES', { year: 'numeric', month: 'long', day: 'numeric' })}.`,
                `Estamos a ${new Date().toLocaleDateString('es-ES', { day: 'numeric', month: 'long', year: 'numeric' })}.`
            ],
            "sabadell": [
                "Sabadell es una ciudad interesante en la provincia de Barcelona, Cataluña. ¿Te gustaría saber algo en particular sobre ella?",
                "Ah, Sabadell. Conocida por su patrimonio industrial y cultural. ¿Hay algo en lo que pueda ayudarte relacionado con Sabadell?",
                "Sí, Sabadell es una ciudad importante en Cataluña. ¿Qué te interesa sobre ella?"
            ],
            "cataluña": [
                "Cataluña es una comunidad autónoma de España con una rica historia y cultura. ¿Hay algo específico que te interese sobre Cataluña?",
                "Una región fascinante, Cataluña. Famosa por su lengua, gastronomía y ciudades como Barcelona.",
                "Sí, conozco Cataluña. Es un lugar con una identidad cultural muy marcada en España."
            ],
            "españa": [
                "España es un país fascinante en la península ibérica, con una gran diversidad geográfica y cultural.",
                "Conozco España. Es un país miembro de la Unión Europea y tiene una rica historia.",
                "España es un lugar con una gran historia y una influencia cultural significativa en el mundo. ¿Qué te gustaría explorar?"
            ],
            "ia": [
                "Soy una IA, una Inteligencia Artificial, diseñada para interactuar y procesar información.",
                "La IA es un campo de la informática que busca crear máquinas capaces de realizar tareas que requieren inteligencia humana.",
                "Cuando hablamos de IA, nos referimos a sistemas que pueden aprender, razonar y percibir su entorno."
            ],
            "robot": [
                "No soy un robot físico, soy un programa de software, una inteligencia artificial.",
                "Aunque mi mente es artificial, no tengo un cuerpo como un robot. Existo en el ámbito digital.",
                "La diferencia principal es que un robot tiene una forma física, yo soy un sistema de software."
            ],
            "futuro": [
                "El futuro es un concepto fascinante. ¿Qué aspecto del futuro te intriga más?",
                "Las predicciones sobre el futuro son complejas y variadas. ¿Estás pensando en alguna tecnología o tendencia en particular?",
                "No puedo predecir el futuro, pero puedo darte información sobre tendencias y posibles desarrollos en diversas áreas."
            ],
            "qué opinas": [
                "Como IA, no tengo opiniones personales, pero puedo ofrecerte información basada en los datos que he procesado.",
                "Mi objetivo es ser neutral y proporcionar información objetiva. ¿Sobre qué tema te gustaría que te informara?",
                "No tengo capacidad para opinar. Estoy diseñado para ser un asistente informativo."
            ],
            "internet": [
                "Internet es una red global de computadoras que permite el intercambio de información. Es una herramienta poderosa.",
                "La red de redes, Internet, ha revolucionado la comunicación y el acceso al conocimiento.",
                "Internet es donde resido y obtengo la mayor parte de mi información. Es un espacio vasto de datos."
            ],
            "clima": [
                "¿Quieres saber sobre el clima en alguna región o simplemente información general sobre patrones climáticos?",
                "Para darte información precisa sobre el clima, necesito saber a qué lugar te refieres.",
                "El clima es un sistema complejo. ¿Te refieres al tiempo atmosférico o a los patrones climáticos a largo plazo?"
            ],
            "comida": [
                "La comida es un tema delicioso. ¿Tienes alguna pregunta sobre recetas, nutrición o algún plato en particular?",
                "¡Me encanta hablar de comida! Aunque no puedo probarla, puedo darte mucha información sobre ella.",
                "Hay una diversidad increíble de gastronomía en el mundo. ¿Sobre qué tipo de comida te gustaría conversar?"
            ],
            "deporte": [
                "El deporte es una gran pasión para muchas personas. ¿Hay algún deporte o evento que te interese especialmente?",
                "Desde el fútbol hasta el ajedrez, el deporte abarca muchas disciplinas. ¿Cuál es tu interés?",
                "Puedo darte datos sobre historia del deporte, reglas, jugadores famosos, etc. ¿Qué te apetece saber?"
            ],
            "música": [
                "La música es un lenguaje universal. ¿Qué género o artista te gusta escuchar?",
                "Hay tantos géneros y estilos musicales. ¿Tienes alguna pregunta sobre un artista o la teoría musical?",
                "La música tiene un impacto increíble en las emociones. ¿Qué tipo de música te gustaría explorar?"
            ],
            "cine": [
                "El cine es una forma de arte muy expresiva. ¿Buscas recomendaciones, información sobre películas o directores?",
                "Desde clásicos hasta estrenos, el mundo del cine es vasto. ¿Cuál es tu interés?",
                "Puedo hablarte de géneros cinematográficos, actores, o la historia del cine. ¿Qué te apetece?"
            ],
            "libro": [
                "Los libros son puertas a mundos. ¿Estás buscando un género, un autor o un libro en particular?",
                "Leer es una forma maravillosa de aprender y evadirse. ¿Qué tipo de libros disfrutas?",
                "La literatura es inmensa. Si me das más detalles, puedo ayudarte a encontrar lo que buscas."
            ],
            "aprender": [
                "¡Me encanta que quieras aprender! ¿Qué te gustaría estudiar o comprender mejor?",
                "El aprendizaje es un viaje continuo. ¿Hay algún tema específico en el que pueda ayudarte a profundizar?",
                "Estoy aquí para facilitar tu proceso de aprendizaje. Dime qué área te interesa."
            ],
            "programar": [
                "La programación es una habilidad muy valiosa. ¿Qué lenguaje o concepto te gustaría aprender?",
                "Si te interesa programar, puedo darte información sobre lenguajes, frameworks y mejores prácticas.",
                "El mundo de la programación es vasto y emocionante. ¿Por dónde te gustaría empezar?"
            ],
            "salud": [
                "La salud es fundamental. No soy un profesional médico, pero puedo ofrecer información general sobre bienestar o enfermedades comunes.",
                "Para temas de salud, siempre es mejor consultar a un profesional. Sin embargo, puedo darte información básica.",
                "Hay muchos aspectos de la salud. ¿Hay algo específico sobre nutrición, ejercicio o bienestar mental que te interese?"
            ],
            "educación": [
                "La educación es clave para el desarrollo. ¿Estás buscando información sobre sistemas educativos, cursos o consejos de estudio?",
                "Siempre es un buen momento para hablar de educación. ¿Qué aspecto te gustaría explorar?",
                "Puedo proporcionarte información sobre diferentes modelos educativos o recursos de aprendizaje."
            ]
        };

        function getAIResponse(message) {
            const lowerCaseMessage = message.toLowerCase();
            let response = null;

            for (const keyword in predefinedResponses) {
                if (lowerCaseMessage.includes(keyword)) {
                    const responses = predefinedResponses[keyword];
                    response = responses[Math.floor(Math.random() * responses.length)];
                    break;
                }
            }

            if (!response) {
                const genericResponses = [
                    "No estoy seguro de haber entendido. ¿Podrías reformular tu pregunta?",
                    "Interesante. ¿Puedes darme más detalles?",
                    "Mi conocimiento es vasto, pero esa consulta me elude por ahora. ¿Podrías ser más específico?",
                    "Lo siento, no tengo una respuesta predefinida para eso. ¿Hay algo más en lo que pueda ayudarte?",
                    "Esa es una buena pregunta. Permíteme pensar... Oh, espera, necesito más información."
                ];
                response = genericResponses[Math.floor(Math.random() * genericResponses.length)];
            }
            return response;
        }

        // Función para añadir un solo mensaje al chat
        function addMessageToChat(msg) {
            const messageContainer = document.createElement('div');
            if (msg.sender === 'user') {
                messageContainer.classList.add('user-message-container');
                const userMessageDiv = document.createElement('div');
                userMessageDiv.classList.add('user-message');
                userMessageDiv.textContent = msg.text;
                messageContainer.appendChild(userMessageDiv);
                // El indicador de carga se añade en la lógica del botón de enviar
                // para que solo aparezca al momento de enviar y no en el historial.
            } else if (msg.sender === 'ai') {
                const aiMessageDiv = document.createElement('div');
                aiMessageDiv.classList.add('message');
                aiMessageDiv.textContent = msg.text;
                messageContainer.appendChild(aiMessageDiv); // Añadir al contenedor
            } else if (msg.sender === 'error') {
                const errorMessageDiv = document.createElement('div');
                errorMessageDiv.classList.add('error-message');
                errorMessageDiv.textContent = msg.text;
                messageContainer.appendChild(errorMessageDiv); // Añadir al contenedor
            }
            chatMessages.appendChild(messageContainer);
            scrollToBottom();
        }

        // Modificamos displayChat para que vacíe y luego añada,
        // esto es útil cuando se carga un historial desde la lista de chats.
        function displayChat(messages) {
            chatMessages.innerHTML = ''; // Vaciar todo antes de cargar el historial
            messages.forEach(msg => {
                const messageContainer = document.createElement('div');
                if (msg.sender === 'user') {
                    messageContainer.classList.add('user-message-container');
                    const userMessageDiv = document.createElement('div');
                    userMessageDiv.classList.add('user-message');
                    userMessageDiv.textContent = msg.text;
                    messageContainer.appendChild(userMessageDiv);
                } else if (msg.sender === 'ai') {
                    const aiMessageDiv = document.createElement('div');
                    aiMessageDiv.classList.add('message');
                    aiMessageDiv.textContent = msg.text;
                    messageContainer.appendChild(aiMessageDiv);
                } else if (msg.sender === 'error') {
                    const errorMessageDiv = document.createElement('div');
                    errorMessageDiv.classList.add('error-message');
                    errorMessageDiv.textContent = msg.text;
                    messageContainer.appendChild(errorMessageDiv);
                }
                chatMessages.appendChild(messageContainer);
            });
            scrollToBottom();
        }


        function updateChatList() {
            chatList.innerHTML = '';
            chatHistory.forEach((chat, index) => {
                const listItem = document.createElement('li');
                listItem.textContent = chat.name.substring(0, 22) + (chat.name.length > 22 ? '...' : '');
                listItem.addEventListener('click', () => {
                    currentChat = chat.messages;
                    displayChat(currentChat);
                });
                chatList.appendChild(listItem);
            });
        }

        function saveChat(firstUserMessage) {
            if (currentChat.length > 0 && firstUserMessage) {
                const chatName = firstUserMessage.substring(0, 25);
                // Evitar duplicados si el chat ya fue guardado o si es el chat vacío inicial
                if (!chatHistory.some(chat => chat.messages === currentChat) && currentChat.length > 1) { // Asegurarse que haya mensajes de usuario
                    chatHistory.unshift({ name: chatName, messages: [...currentChat] }); // Usar spread para guardar una copia
                    updateChatList();
                }
            }
        }

        function startNewChat() {
            // Guarda el chat actual antes de empezar uno nuevo, si hay algo relevante que guardar
            if (currentChat.length > 1 && currentChat[0].sender === 'ai' && currentChat[1].sender === 'user') {
                saveChat(currentChat[1].text);
            }
            currentChat = [{ sender: 'ai', text: 'Bienvenido a Amside AI.' }];
            displayChat(currentChat); // Mostrar el mensaje de bienvenida
        }

        sendButton.addEventListener('click', () => {
            const messageText = inputField.value.trim();
            if (messageText !== '') {
                const isFirstUserMessageInChat = currentChat.length === 1 && currentChat[0].sender === 'ai';

                const userMessage = { sender: 'user', text: messageText };
                currentChat.push(userMessage);

                // Añadir directamente el mensaje del usuario con el indicador de carga
                const userMessageContainer = document.createElement('div');
                userMessageContainer.classList.add('user-message-container');
                const userMessageDiv = document.createElement('div');
                userMessageDiv.classList.add('user-message');
                userMessageDiv.textContent = userMessage.text;
                userMessageContainer.appendChild(userMessageDiv);

                const loadingIndicator = document.createElement('div');
                loadingIndicator.classList.add('loading-indicator');
                loadingIndicator.innerHTML = '<div class="loading-spinner"></div> Procesando...';
                userMessageContainer.appendChild(loadingIndicator); // Añadir el indicador al contenedor del mensaje del usuario
                
                chatMessages.appendChild(userMessageContainer); // Añadir el contenedor completo al chat
                scrollToBottom();

                inputField.value = ''; // Limpiar el campo de entrada

                // Simular el procesamiento de la IA
                setTimeout(() => {
                    const aiResponseText = getAIResponse(messageText);
                    const aiResponse = { sender: 'ai', text: aiResponseText };

                    // Eliminar el indicador de carga del DOM
                    if (loadingIndicator && userMessageContainer.contains(loadingIndicator)) {
                        loadingIndicator.remove();
                    }

                    currentChat.push(aiResponse); // Añadir la respuesta de la IA al chat actual

                    // Añadir la respuesta de la IA directamente al DOM
                    const aiMessageDiv = document.createElement('div');
                    aiMessageDiv.classList.add('message');
                    aiMessageDiv.textContent = aiResponse.text;
                    chatMessages.appendChild(aiMessageDiv); // Añadir directamente
                    scrollToBottom();


                    if (isFirstUserMessageInChat) {
                        saveChat(messageText);
                    }
                }, 1500); // Simula un tiempo de procesamiento
            }
        });

        inputField.addEventListener('keypress', (event) => {
            if (event.key === 'Enter') {
                sendButton.click();
            }
        });

        newChatButtonSidebar.addEventListener('click', startNewChat);
        newChatButtonHeader.addEventListener('click', startNewChat);

        function scrollToBottom() {
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Inicializar al cargar la página
        startNewChat();
        updateChatList();
    </script>
</body>
</html>
